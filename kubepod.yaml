metadata:
  labels:
    podpurpose: mavenbuild
spec:
  containers:
  - name: jnlp
    image: jenkins/jnlp-agent-alpine:latest
    volumeMounts:
    - name: home-volume
      mountPath: /home/jenkins    
    env:
    - name: CONTAINER_ENV_VAR
      value: jnlp    
    - name: HOME
      value: /home/jenkins  
    - name: JENKINS_URL
      value: http://jenkins-svc
    - name: JENKINS_TUNNEL
      value: jenkins-svc:50000
    workingDir: /home/jenkins/agent
  - name: maven
    image: maven:3.8.1-jdk-8       
    env:
    - name: CONTAINER_ENV_VAR
      value: maven  
    - name: DOCKER_HOST
      value: tcp://localhost:2375
    command:
    - sleep
    args:
    - 99d        
    volumeMounts:
    - name: home-volume
      mountPath: /home/jenkins   
    - name: settingsxml
      mountPath: /root/tmp/  
    - name: dind-storage
      mountPath: /var/lib/docker        
    workingDir: /home/jenkins/agent    
  - name: dind
    image: docker:19.03.0-dind
    command: ["sh"]
    volumeMounts:
    - name: home-volume
      mountPath: /home/jenkins   
    - name: settingsxml
      mountPath: /root/tmp/  
    - name: dind-storage
      mountPath: /var/lib/docker        
    securityContext:
      privileged: true               
  volumes:
  - name: home-volume
    emptyDir: {}  
  - name: dind-storage
    emptyDir: {}    
  - name: settingsxml
    secret:
      secretName: settingtest  